.\" Automatically generated by Pod::Man 2.28 (Pod::Simple 3.28)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is turned on, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{
.    if \nF \{
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "E4RAT-REALLOC 8"
.TH E4RAT-REALLOC 8 "2012-05-03" "e4rat 0.2.3" "User Manuals"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "NAME"
e4rat\-realloc \- Reallocation and defragmentation of relevant files
.SH "SYNOPSIS"
.IX Header "SYNOPSIS"
\&\fBe4rat\-realloc\fR  \fB[\fR option(s) \fB]\fR \fB[\fR mode \fB]\fR file(s)
.SH "DESCRIPTION"
.IX Header "DESCRIPTION"
e4rat\-realloc is a relevant file defrag program based on \s-1EXT4_IOC_MOVE_EXT\s0 ioctl from ext4 filesystems. It physically places files into a sequence of neighbouring blocks on disk. The reallocation process can be done when the filesystem is still mounted. For security reasons write access to each file is needed.
.PP
If you want to process files from a program it is recommended to kill them at first. Linux does not allow to open files writable while it is still executed. So it is not possible to process the program executable binary. Those files get excluded automatically.
.PP
Add list files to be proceeded either as parameters and/or over stdin. The list \fIfile(s)\fR must be in a format generated by e4rat\-collect.
.SH "OPTIONS"
.IX Header "OPTIONS"
.IP "\-V \-\-version" 4
.IX Item "-V --version"
show version information and exit.
.IP "\-h \-\-help" 4
.IX Item "-h --help"
display usage message and exit.
.IP "\-v \-\-verbose" 4
.IX Item "-v --verbose"
increment verbosity level.
.IP "\-q \-\-quiet" 4
.IX Item "-q --quiet"
set verbosity level to 0. This means that no messages will be displayed.
.IP "\-l \-\-loglevel <number>" 4
.IX Item "-l --loglevel <number>"
set loglevel to <number>. All log messages are sent either to the Kernel log (see \fIdmesg\fR\|(1)) or to \fIsyslog\fR\|(3).
.IP "\-f \-\-force" 4
.IX Item "-f --force"
force reallocating files even though it will get worse afterwards.
.SH "DEFRAG MODES"
.IX Header "DEFRAG MODES"
.IP "\-p \-\-use\-prealloc" 4
.IX Item "-p --use-prealloc"
use the pre-allocation ioctl to rearrange files on disk. Furthermore this mode supports to eliminate gaps of unallocated blocks in sparse files. Unfortunately, this ioctl is presently under heavy development by Kazuya Mio and has not yet entered the Linux Kernel. Therefore you have to apply this Kernel patch fist:
http://kt1.osuosl.org/mailarchive/linux\-fsdevel/2010/12/1/6887724
Do this at your own risk.
.IP "\-g \-\-use\-locality\-group" 4
.IX Item "-g --use-locality-group"
The ext4 filesystem allocates small files in so-called locality groups. Each \s-1CPU\s0 manages its own group. 
The \*(L"locality-group\*(R" method makes use of this feature in order to rearrange the files on disk. In contrast to the \*(L"prealloc\*(R" method, no kernel patch is required. However, the placement may me suboptimal.
While creating donor files is in progress, it is necessary to increase the limit which indicates small files. 
As a result other allocation requests occurring at the same time will be also satisfied with blocks from the locality group as well. It is the best if you just avoid heavy write access to disk.
.IP "\-t \-\-use\-tld" 4
.IX Item "-t --use-tld"
select the \*(L"use-tld\*(R" method to rearrange files on disk.
With this method, all donor files are created in a new top level directory.
The so-called Orlov algorithm put top level directory into an empty block group. As a result, donor files will be allocated near this directory. But there is no guarantee that the donor files are allocated in their access order.
.Sp
Also, ext4's block allocator normalizes every block request to a power of 2. This typically leads to small holes between the files.
.SH "FILES"
.IX Header "FILES"
\&\fI/etc/e4rat.conf\fR
     E4rat configuration file.
.SH "AUTHOR"
.IX Header "AUTHOR"
Written by Andreas Rid and Gundolf Kiefer.
.SH "REPORTING BUGS"
.IX Header "REPORTING BUGS"
Report bugs to Andreas Rid <conso at users.sf.net>.
.SH "SEE ALSO"
.IX Header "SEE ALSO"
\&\fIe4rat\-collect\fR\|(8), \fIe4rat\-preload\fR\|(8), \fIe4rat.conf\fR\|(8)
